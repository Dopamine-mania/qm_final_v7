<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmoHealç ”ç©¶ç³»ç»Ÿ - å®Œæ•´æµç¨‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft YaHei', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #2c3e50;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Queen Mary Header */
        .qmul-header {
            background: #990033;
            color: white;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(153, 0, 51, 0.3);
        }

        .qmul-logo {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .qmul-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        /* è¯­è¨€åˆ‡æ¢å™¨ */
        .language-switcher {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #990033;
            color: #990033;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .lang-btn.active {
            background: #990033;
            color: white;
        }

        .lang-btn:hover:not(.active) {
            background: rgba(153, 0, 51, 0.1);
        }

        /* Progress Steps */
        .progress-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 20px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 8%;
            right: 8%;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.completed {
            background: #28a745;
            color: white;
        }

        .step.current {
            background: #990033;
            color: white;
            animation: pulse 2s infinite;
        }

        .step.pending {
            background: white;
            border: 2px solid #e9ecef;
            color: #6c757d;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Main Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            margin-bottom: 2rem;
            animation: fadeIn 0.5s ease-in;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #990033;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        h2 {
            color: #2c3e50;
            margin: 1.5rem 0 1rem;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .alert-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1976d2;
        }

        .alert-success {
            background: #e8f5e8;
            border: 1px solid #28a745;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #990033;
            box-shadow: 0 0 0 3px rgba(153, 0, 51, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        /* Checkbox Styles */
        .checkbox-group {
            margin: 2rem 0;
        }

        .checkbox-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #990033;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 1rem;
            transform: scale(1.2);
        }

        .checkbox-text {
            font-size: 0.95rem;
            line-height: 1.6;
            cursor: pointer;
        }

        /* Likert Scale */
        .likert-scale {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 1rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .scale-label {
            font-size: 0.8rem;
            color: #6c757d;
            text-align: center;
            flex: 0 0 100px;
        }

        .scale-options {
            display: flex;
            gap: 1rem;
            flex: 1;
            justify-content: center;
        }

        .scale-option {
            text-align: center;
        }

        .scale-option input[type="radio"] {
            display: none;
        }

        .scale-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            border: 2px solid #dee2e6;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .scale-option input[type="radio"]:checked + .scale-number {
            background: #990033;
            color: white;
            border-color: #990033;
        }

        /* Button Styles */
        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: space-between;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            min-width: 120px;
        }

        .btn-primary {
            background: #990033;
            color: white;
        }

        .btn-primary:hover {
            background: #7a0028;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Therapy Interface Styles - ä»therapy_interface_bilingual.htmlå¤åˆ¶ */
        .therapy-container {
            text-align: center;
            min-height: 60vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .therapy-title {
            font-size: 2.5rem;
            font-weight: 300;
            color: #990033;
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: fadeIn 1s ease-out forwards;
        }

        .therapy-subtitle {
            font-size: 1.2rem;
            color: #6c757d;
            margin-bottom: 3rem;
            opacity: 0;
            animation: fadeIn 1s ease-out 0.3s forwards;
        }

        .input-section {
            margin-bottom: 2rem;
            opacity: 0;
            animation: fadeIn 1s ease-out 0.5s forwards;
        }

        .input-label {
            display: block;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .emotion-textarea {
            width: 100%;
            padding: 20px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
            font-size: 1.1rem;
            resize: none;
            transition: all 0.3s ease;
            font-family: inherit;
            min-height: 120px;
        }

        .emotion-textarea:focus {
            outline: none;
            border-color: #990033;
            box-shadow: 0 0 0 3px rgba(153, 0, 51, 0.1);
        }

        .therapy-btn {
            margin-top: 20px;
            padding: 15px 40px;
            background: linear-gradient(135deg, #990033, #7a0028);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(153, 0, 51, 0.3);
        }

        .therapy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(153, 0, 51, 0.4);
        }

        .therapy-btn:disabled {
            background: #e0d5c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .feedback-text {
            display: none;
            font-size: 1.2rem;
            color: #2c3e50;
            margin: 2rem 0;
            opacity: 0;
            animation: fadeIn 1s ease-out forwards;
        }

        .breathing-circle {
            display: none;
            width: 200px;
            height: 200px;
            margin: 3rem auto;
            position: relative;
        }

        .circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(153, 0, 51, 0.3) 0%, 
                rgba(153, 0, 51, 0.1) 50%, 
                transparent 70%);
            animation: breathe 4s ease-in-out infinite;
        }

        .circle:nth-child(2) { animation-delay: 1s; }
        .circle:nth-child(3) { animation-delay: 2s; }

        @keyframes breathe {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        .breathing-hint {
            display: none;
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 1rem;
            opacity: 0;
            animation: fadeIn 1s ease-out 0.5s forwards;
        }

        .video-section {
            display: none;
            opacity: 0;
            transition: opacity 2s ease-in;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        video {
            width: 100%;
            border-radius: 20px;
            background-color: #1a1a1a;
            object-fit: cover;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #990033;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }

            .content-section {
                padding: 1.5rem;
            }

            .therapy-title {
                font-size: 2rem;
            }

            .btn-group {
                flex-direction: column;
            }

            .progress-steps {
                margin-bottom: 1rem;
            }

            .step {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }

            .scale-options {
                gap: 0.5rem;
            }

            .scale-number {
                width: 35px;
                height: 35px;
                line-height: 35px;
            }
        }

        /* Therapy Experience Styles (Step 4) - Only active when Step 4 is current */
        .content-section.active#section-4 {
            background: linear-gradient(135deg, 
                #FDF6E4 0%, 
                #FFE5CC 25%, 
                #FFD4B3 50%, 
                #FFC299 75%, 
                #FFB380 100%);
            color: #5D4E37;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .content-section.active#section-4::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                #FDF6E4 0%, 
                #FFE5CC 25%, 
                #FFD4B3 50%, 
                #FFC299 75%, 
                #FFB380 100%);
            opacity: 0.3;
            z-index: -1;
        }

        .therapy-container {
            width: 90%;
            max-width: 600px;
            text-align: center;
            z-index: 1;
        }

        .therapy-title {
            font-size: 2.5rem;
            font-weight: 300;
            color: #5D4E37;
            margin-bottom: 0.5rem;
        }

        .therapy-subtitle {
            font-size: 1.2rem;
            color: #9D8B7D;
            margin-bottom: 3rem;
        }

        .input-section {
            margin-bottom: 2rem;
        }

        .input-label {
            display: block;
            font-size: 1.1rem;
            color: #5D4E37;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .emotion-textarea {
            width: 100%;
            padding: 20px;
            border: 3px solid #E8D5C4;
            border-radius: 20px;
            font-size: 1rem;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.9);
            color: #5D4E37;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .emotion-textarea:focus {
            outline: none;
            border-color: #FFB380;
            box-shadow: 0 0 0 3px rgba(255, 179, 128, 0.2);
        }

        .therapy-btn {
            margin-top: 20px;
            padding: 15px 40px;
            background: linear-gradient(135deg, #FFB380, #FF9966);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 179, 128, 0.3);
        }

        .therapy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 179, 128, 0.4);
        }

        .therapy-btn:disabled {
            background: #E0D5C7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Override language switcher colors for therapy section - only when active */
        .content-section.active#section-4 .lang-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #FFD4B3;
            color: #5D4E37;
        }

        .content-section.active#section-4 .lang-btn.active {
            background: linear-gradient(135deg, #FFB380, #FF9966);
            color: white;
            border-color: #FF9966;
        }

        /* Hide therapy interface elements by default - only show when Step 4 is active */
        .content-section:not(.active) .therapy-container,
        .content-section:not(#section-4) .therapy-container,
        .content-section:not(.active) .breathing-circle,
        .content-section:not(#section-4) .breathing-circle,
        .content-section:not(.active) .breathing-hint,
        .content-section:not(#section-4) .breathing-hint,
        .content-section:not(.active) .video-section,
        .content-section:not(#section-4) .video-section {
            display: none !important;
        }

        /* Only show therapy styles when Step 4 is active */
        .content-section#section-4:not(.active) {
            background: #f8f9fa !important;
            color: #333 !important;
        }

        /* Ensure Step 4 uses normal EmoHeal styling when not active */
        .content-section#section-4:not(.active)::before {
            display: none !important;
        }

        /* Ensure other steps maintain their normal appearance */
        .content-section:not(#section-4) {
            background: #f8f9fa;
            color: #333;
        }

        /* Thank you page styles */
        .success-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .session-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
        }
    </style>
    
    <!-- ğŸŒ Global API Configuration -->
    <script src="config.js"></script>
</head>
<body>
    <!-- Queen Mary Header -->
    <div class="qmul-header">
        <div class="qmul-logo">Queen Mary University of London</div>
        <div class="qmul-subtitle">School of Electronic Engineering and Computer Science</div>
    </div>

    <!-- Language Switcher -->
    <div class="language-switcher">
        <button class="lang-btn active" onclick="switchLanguage('zh')">ä¸­æ–‡</button>
        <button class="lang-btn" onclick="switchLanguage('en')">English</button>
    </div>

    <!-- Progress Steps -->
    <div class="progress-container">
        <div class="progress-steps">
            <div class="step current" id="step-1">1</div>
            <div class="step pending" id="step-2">2</div>
            <div class="step pending" id="step-3">3</div>
            <div class="step pending" id="step-4">4</div>
            <div class="step pending" id="step-5">5</div>
            <div class="step pending" id="step-6">6</div>
        </div>
    </div>

    <div class="container">
        <!-- Step 1: Welcome Portal -->
        <div class="content-section active" id="section-1">
            <h1 data-zh="Welcome to the EmoHeal Research Study" data-en="Welcome to the EmoHeal Research Study">Welcome to the EmoHeal Research Study</h1>
            
            <div class="alert alert-info">
                <strong data-zh="ç ”ç©¶é¡¹ç›® / Research Study" data-en="ç ”ç©¶é¡¹ç›® / Research Study">ç ”ç©¶é¡¹ç›® / Research Study</strong>: EmoHeal: An Experimental Study of an AI System for Personalized Healing Narratives
            </div>

            <h2 data-zh="Study Overview / ç ”ç©¶æ¦‚è¿°" data-en="Study Overview / ç ”ç©¶æ¦‚è¿°">Study Overview / ç ”ç©¶æ¦‚è¿°</h2>
            <p data-zh="You are being invited to participate in a research study conducted by Queen Mary University of London. This study explores how artificial intelligence can be used to create personalized therapeutic experiences through music and emotion analysis." 
               data-en="You are being invited to participate in a research study conducted by Queen Mary University of London. This study explores how artificial intelligence can be used to create personalized therapeutic experiences through music and emotion analysis.">
                You are being invited to participate in a research study conducted by Queen Mary University of London. 
                This study explores how artificial intelligence can be used to create personalized therapeutic experiences 
                through music and emotion analysis.
            </p>
            <p data-zh="æˆ‘ä»¬é‚€è¯·æ‚¨å‚ä¸ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢è¿›è¡Œçš„ç ”ç©¶é¡¹ç›®ã€‚æœ¬ç ”ç©¶æ¢è®¨å¦‚ä½•åˆ©ç”¨äººå·¥æ™ºèƒ½é€šè¿‡éŸ³ä¹å’Œæƒ…æ„Ÿåˆ†æåˆ›å»ºä¸ªæ€§åŒ–æ²»ç–—ä½“éªŒã€‚"
               data-en="æˆ‘ä»¬é‚€è¯·æ‚¨å‚ä¸ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢è¿›è¡Œçš„ç ”ç©¶é¡¹ç›®ã€‚æœ¬ç ”ç©¶æ¢è®¨å¦‚ä½•åˆ©ç”¨äººå·¥æ™ºèƒ½é€šè¿‡éŸ³ä¹å’Œæƒ…æ„Ÿåˆ†æåˆ›å»ºä¸ªæ€§åŒ–æ²»ç–—ä½“éªŒã€‚">
                æˆ‘ä»¬é‚€è¯·æ‚¨å‚ä¸ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢è¿›è¡Œçš„ç ”ç©¶é¡¹ç›®ã€‚æœ¬ç ”ç©¶æ¢è®¨å¦‚ä½•åˆ©ç”¨äººå·¥æ™ºèƒ½é€šè¿‡éŸ³ä¹å’Œæƒ…æ„Ÿåˆ†æåˆ›å»ºä¸ªæ€§åŒ–æ²»ç–—ä½“éªŒã€‚
            </p>

            <h2 data-zh="What to Expect / ç ”ç©¶æµç¨‹" data-en="What to Expect / ç ”ç©¶æµç¨‹">What to Expect / ç ”ç©¶æµç¨‹</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h3 data-zh="Study Flow / ç ”ç©¶æ­¥éª¤:" data-en="Study Flow / ç ”ç©¶æ­¥éª¤:">Study Flow / ç ”ç©¶æ­¥éª¤:</h3>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li><strong data-zh="Participant Information" data-en="Participant Information">Participant Information</strong> - <span data-zh="Read detailed study information / é˜…è¯»è¯¦ç»†ç ”ç©¶ä¿¡æ¯" data-en="Read detailed study information / é˜…è¯»è¯¦ç»†ç ”ç©¶ä¿¡æ¯">Read detailed study information / é˜…è¯»è¯¦ç»†ç ”ç©¶ä¿¡æ¯</span></li>
                    <li><strong data-zh="Consent Form" data-en="Consent Form">Consent Form</strong> - <span data-zh="Provide informed consent / çŸ¥æƒ…åŒæ„" data-en="Provide informed consent / çŸ¥æƒ…åŒæ„">Provide informed consent / çŸ¥æƒ…åŒæ„</span></li>
                    <li><strong data-zh="Therapy Experience" data-en="Therapy Experience">Therapy Experience</strong> - <span data-zh="Use the AI music therapy system / ä½“éªŒAIéŸ³ä¹ç–—æ„ˆç³»ç»Ÿ" data-en="Use the AI music therapy system / ä½“éªŒAIéŸ³ä¹ç–—æ„ˆç³»ç»Ÿ">Use the AI music therapy system / ä½“éªŒAIéŸ³ä¹ç–—æ„ˆç³»ç»Ÿ</span></li>
                    <li><strong data-zh="Questionnaire" data-en="Questionnaire">Questionnaire</strong> - <span data-zh="Share your feedback / å¡«å†™åé¦ˆé—®å·" data-en="Share your feedback / å¡«å†™åé¦ˆé—®å·">Share your feedback / å¡«å†™åé¦ˆé—®å·</span></li>
                    <li><strong data-zh="Completion" data-en="Completion">Completion</strong> - <span data-zh="Thank you and data download / å®Œæˆå¹¶ä¸‹è½½æ•°æ®" data-en="Thank you and data download / å®Œæˆå¹¶ä¸‹è½½æ•°æ®">Thank you and data download / å®Œæˆå¹¶ä¸‹è½½æ•°æ®</span></li>
                </ol>
            </div>

            <h2 data-zh="Key Information / é‡è¦ä¿¡æ¯" data-en="Key Information / é‡è¦ä¿¡æ¯">Key Information / é‡è¦ä¿¡æ¯</h2>
            <ul style="margin-left: 20px; line-height: 1.8;">
                <li><strong data-zh="Duration:" data-en="Duration:">Duration:</strong> <span data-zh="Approximately 5-10 minutes / å¤§çº¦5-10åˆ†é’Ÿ" data-en="Approximately 5-10 minutes / å¤§çº¦5-10åˆ†é’Ÿ">Approximately 5-10 minutes / å¤§çº¦5-10åˆ†é’Ÿ</span></li>
                <li><strong data-zh="Participation:" data-en="Participation:">Participation:</strong> <span data-zh="Completely voluntary / å®Œå…¨è‡ªæ„¿å‚ä¸" data-en="Completely voluntary / å®Œå…¨è‡ªæ„¿å‚ä¸">Completely voluntary / å®Œå…¨è‡ªæ„¿å‚ä¸</span></li>
                <li><strong data-zh="Data:" data-en="Data:">Data:</strong> <span data-zh="Anonymous and confidential / åŒ¿åä¸”ä¿å¯†" data-en="Anonymous and confidential / åŒ¿åä¸”ä¿å¯†">Anonymous and confidential / åŒ¿åä¸”ä¿å¯†</span></li>
                <li><strong data-zh="Ethics Reference:" data-en="Ethics Reference:">Ethics Reference:</strong> QMERC20.565.DSEECS25.045</li>
            </ul>

            <h2 data-zh="Researchers / ç ”ç©¶äººå‘˜" data-en="Researchers / ç ”ç©¶äººå‘˜">Researchers / ç ”ç©¶äººå‘˜</h2>
            <p>
                <strong data-zh="Principal Investigators:" data-en="Principal Investigators:">Principal Investigators:</strong><br>
                â€¢ Xinchen Wan (Postgraduate Student)<br>
                â€¢ Huan Zhang (Supervisor)
            </p>

            <div class="alert alert-warning">
                <strong data-zh="Important Notice / é‡è¦æé†’:" data-en="Important Notice / é‡è¦æé†’:">Important Notice / é‡è¦æé†’:</strong><br>
                <span data-zh="By proceeding, you acknowledge that you have read this information and are interested in participating. You will have the opportunity to read detailed information and provide formal consent before the study begins." 
                      data-en="By proceeding, you acknowledge that you have read this information and are interested in participating. You will have the opportunity to read detailed information and provide formal consent before the study begins.">
                    By proceeding, you acknowledge that you have read this information and are interested in participating. 
                    You will have the opportunity to read detailed information and provide formal consent before the study begins.
                </span>
                <br><br>
                <span data-zh="ç»§ç»­è¿›è¡Œå³è¡¨ç¤ºæ‚¨å·²é˜…è¯»æ­¤ä¿¡æ¯å¹¶æœ‰å…´è¶£å‚ä¸ã€‚åœ¨ç ”ç©¶å¼€å§‹ä¹‹å‰ï¼Œæ‚¨å°†æœ‰æœºä¼šé˜…è¯»è¯¦ç»†ä¿¡æ¯å¹¶æä¾›æ­£å¼åŒæ„ã€‚"
                      data-en="ç»§ç»­è¿›è¡Œå³è¡¨ç¤ºæ‚¨å·²é˜…è¯»æ­¤ä¿¡æ¯å¹¶æœ‰å…´è¶£å‚ä¸ã€‚åœ¨ç ”ç©¶å¼€å§‹ä¹‹å‰ï¼Œæ‚¨å°†æœ‰æœºä¼šé˜…è¯»è¯¦ç»†ä¿¡æ¯å¹¶æä¾›æ­£å¼åŒæ„ã€‚">
                    ç»§ç»­è¿›è¡Œå³è¡¨ç¤ºæ‚¨å·²é˜…è¯»æ­¤ä¿¡æ¯å¹¶æœ‰å…´è¶£å‚ä¸ã€‚åœ¨ç ”ç©¶å¼€å§‹ä¹‹å‰ï¼Œæ‚¨å°†æœ‰æœºä¼šé˜…è¯»è¯¦ç»†ä¿¡æ¯å¹¶æä¾›æ­£å¼åŒæ„ã€‚
                </span>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                    <span data-zh="Back / è¿”å›" data-en="Back / è¿”å›">Back / è¿”å›</span>
                </button>
                <button type="button" class="btn btn-primary" onclick="nextStep()">
                    <span data-zh="Begin Study / å¼€å§‹ç ”ç©¶" data-en="Begin Study / å¼€å§‹ç ”ç©¶">Begin Study / å¼€å§‹ç ”ç©¶</span>
                </button>
            </div>
        </div>

        <!-- Step 2: Participant Information -->
        <div class="content-section" id="section-2">
            <h1 data-zh="Participant Information Sheet" data-en="Participant Information Sheet">Participant Information Sheet</h1>
            <h2 style="text-align: center; color: #666;" data-zh="å‚ä¸è€…ä¿¡æ¯è¡¨" data-en="å‚ä¸è€…ä¿¡æ¯è¡¨">å‚ä¸è€…ä¿¡æ¯è¡¨</h2>
            
            <div class="alert alert-info">
                <strong data-zh="Study Title:" data-en="Study Title:">Study Title:</strong> EmoHeal: An Experimental Study of an AI System for Personalized Healing Narratives<br>
                <strong data-zh="Ethics Reference:" data-en="Ethics Reference:">Ethics Reference:</strong> QMERC20.565.DSEECS25.045
            </div>

            <h2 data-zh="Basic Information / åŸºæœ¬ä¿¡æ¯" data-en="Basic Information / åŸºæœ¬ä¿¡æ¯">Basic Information / åŸºæœ¬ä¿¡æ¯</h2>
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;" data-zh="This information helps us understand our participant demographics. All responses are optional." data-en="This information helps us understand our participant demographics. All responses are optional.">
                This information helps us understand our participant demographics. All responses are optional.
                <br data-zh="æ­¤ä¿¡æ¯å¸®åŠ©æˆ‘ä»¬äº†è§£å‚ä¸è€…çš„äººå£ç»Ÿè®¡ç‰¹å¾ã€‚æ‰€æœ‰å›ç­”éƒ½æ˜¯å¯é€‰çš„ã€‚" data-en="æ­¤ä¿¡æ¯å¸®åŠ©æˆ‘ä»¬äº†è§£å‚ä¸è€…çš„äººå£ç»Ÿè®¡ç‰¹å¾ã€‚æ‰€æœ‰å›ç­”éƒ½æ˜¯å¯é€‰çš„ã€‚">æ­¤ä¿¡æ¯å¸®åŠ©æˆ‘ä»¬äº†è§£å‚ä¸è€…çš„äººå£ç»Ÿè®¡ç‰¹å¾ã€‚æ‰€æœ‰å›ç­”éƒ½æ˜¯å¯é€‰çš„ã€‚
            </p>

            <form id="participant-form">
                <div class="form-group">
                    <label class="form-label" data-zh="Age Group / å¹´é¾„ç»„:" data-en="Age Group / å¹´é¾„ç»„:">Age Group / å¹´é¾„ç»„:</label>
                    <select name="ageGroup" class="form-control">
                        <option value="" data-zh="Select / é€‰æ‹©" data-en="Select / é€‰æ‹©">Select / é€‰æ‹©</option>
                        <option value="18-24">18-24</option>
                        <option value="25-34">25-34</option>
                        <option value="35-44">35-44</option>
                        <option value="45-54">45-54</option>
                        <option value="55-64">55-64</option>
                        <option value="65+">65+</option>
                        <option value="prefer-not-to-say" data-zh="Prefer not to say / ä¸æ„¿é€éœ²" data-en="Prefer not to say / ä¸æ„¿é€éœ²">Prefer not to say / ä¸æ„¿é€éœ²</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" data-zh="Gender / æ€§åˆ«:" data-en="Gender / æ€§åˆ«:">Gender / æ€§åˆ«:</label>
                    <select name="gender" class="form-control">
                        <option value="" data-zh="Select / é€‰æ‹©" data-en="Select / é€‰æ‹©">Select / é€‰æ‹©</option>
                        <option value="female" data-zh="Female / å¥³æ€§" data-en="Female / å¥³æ€§">Female / å¥³æ€§</option>
                        <option value="male" data-zh="Male / ç”·æ€§" data-en="Male / ç”·æ€§">Male / ç”·æ€§</option>
                        <option value="non-binary" data-zh="Non-binary / éäºŒå…ƒæ€§åˆ«" data-en="Non-binary / éäºŒå…ƒæ€§åˆ«">Non-binary / éäºŒå…ƒæ€§åˆ«</option>
                        <option value="other" data-zh="Other / å…¶ä»–" data-en="Other / å…¶ä»–">Other / å…¶ä»–</option>
                        <option value="prefer-not-to-say" data-zh="Prefer not to say / ä¸æ„¿é€éœ²" data-en="Prefer not to say / ä¸æ„¿é€éœ²">Prefer not to say / ä¸æ„¿é€éœ²</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" data-zh="Have you used digital mental health or wellbeing apps before? / æ‚¨ä¹‹å‰æ˜¯å¦ä½¿ç”¨è¿‡æ•°å­—å¿ƒç†å¥åº·æˆ–ç¦ç¥‰åº”ç”¨ï¼Ÿ" 
                           data-en="Have you used digital mental health or wellbeing apps before? / æ‚¨ä¹‹å‰æ˜¯å¦ä½¿ç”¨è¿‡æ•°å­—å¿ƒç†å¥åº·æˆ–ç¦ç¥‰åº”ç”¨ï¼Ÿ">
                        Have you used digital mental health or wellbeing apps before? / 
                        æ‚¨ä¹‹å‰æ˜¯å¦ä½¿ç”¨è¿‡æ•°å­—å¿ƒç†å¥åº·æˆ–ç¦ç¥‰åº”ç”¨ï¼Ÿ
                    </label>
                    <select name="digitalHealthExperience" class="form-control">
                        <option value="" data-zh="Select / é€‰æ‹©" data-en="Select / é€‰æ‹©">Select / é€‰æ‹©</option>
                        <option value="never" data-zh="Never / ä»æœª" data-en="Never / ä»æœª">Never / ä»æœª</option>
                        <option value="rarely" data-zh="Rarely / å¾ˆå°‘" data-en="Rarely / å¾ˆå°‘">Rarely / å¾ˆå°‘</option>
                        <option value="sometimes" data-zh="Sometimes / æœ‰æ—¶" data-en="Sometimes / æœ‰æ—¶">Sometimes / æœ‰æ—¶</option>
                        <option value="often" data-zh="Often / ç»å¸¸" data-en="Often / ç»å¸¸">Often / ç»å¸¸</option>
                        <option value="prefer-not-to-say" data-zh="Prefer not to say / ä¸æ„¿é€éœ²" data-en="Prefer not to say / ä¸æ„¿é€éœ²">Prefer not to say / ä¸æ„¿é€éœ²</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">
                        <span data-zh="Back / è¿”å›" data-en="Back / è¿”å›">Back / è¿”å›</span>
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <span data-zh="Continue to Consent Form / ç»§ç»­åˆ°åŒæ„ä¹¦" data-en="Continue to Consent Form / ç»§ç»­åˆ°åŒæ„ä¹¦">Continue to Consent Form / ç»§ç»­åˆ°åŒæ„ä¹¦</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Step 3: Consent Form -->
        <div class="content-section" id="section-3">
            <h1 data-zh="Informed Consent Form" data-en="Informed Consent Form">Informed Consent Form</h1>
            <h2 style="text-align: center; color: #666;" data-zh="çŸ¥æƒ…åŒæ„ä¹¦" data-en="çŸ¥æƒ…åŒæ„ä¹¦">çŸ¥æƒ…åŒæ„ä¹¦</h2>
            
            <div class="alert alert-info">
                <strong>Study:</strong> EmoHeal: An Experimental Study of an AI System for Personalized Healing Narratives<br>
                <strong>Researchers:</strong> Xinchen Wan, Huan Zhang<br>
                <strong>Ethics Reference:</strong> QMERC20.565.DSEECS25.045
            </div>

            <p style="font-size: 1.1rem; font-weight: 500; color: #2c3e50; margin-bottom: 30px;">
                <span data-zh="Before participating in this study, please read each statement carefully and check the boxes to indicate your agreement. You must agree to all statements to participate." data-en="Before participating in this study, please read each statement carefully and check the boxes to indicate your agreement. You must agree to all statements to participate.">
                    Before participating in this study, please read each statement carefully and check the boxes to indicate your agreement. You must agree to all statements to participate.
                </span>
                <br><br>
                <span data-zh="åœ¨å‚ä¸æœ¬ç ”ç©¶ä¹‹å‰ï¼Œè¯·ä»”ç»†é˜…è¯»æ¯é¡¹å£°æ˜å¹¶å‹¾é€‰æ–¹æ¡†è¡¨ç¤ºåŒæ„ã€‚æ‚¨å¿…é¡»åŒæ„æ‰€æœ‰å£°æ˜æ‰èƒ½å‚ä¸ã€‚" data-en="åœ¨å‚ä¸æœ¬ç ”ç©¶ä¹‹å‰ï¼Œè¯·ä»”ç»†é˜…è¯»æ¯é¡¹å£°æ˜å¹¶å‹¾é€‰æ–¹æ¡†è¡¨ç¤ºåŒæ„ã€‚æ‚¨å¿…é¡»åŒæ„æ‰€æœ‰å£°æ˜æ‰èƒ½å‚ä¸ã€‚">
                    åœ¨å‚ä¸æœ¬ç ”ç©¶ä¹‹å‰ï¼Œè¯·ä»”ç»†é˜…è¯»æ¯é¡¹å£°æ˜å¹¶å‹¾é€‰æ–¹æ¡†è¡¨ç¤ºåŒæ„ã€‚æ‚¨å¿…é¡»åŒæ„æ‰€æœ‰å£°æ˜æ‰èƒ½å‚ä¸ã€‚
                </span>
            </p>

            <form id="consent-form">
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="consent1" name="consent1" class="consent-checkbox" required>
                        <label for="consent1" class="checkbox-text">
                            <strong>1. Voluntary Participation / è‡ªæ„¿å‚ä¸</strong><br>
                            I understand that my participation in this research is voluntary and that I am free to withdraw 
                            at any time without giving any reason and without there being any negative consequences.
                            <br><br>
                            æˆ‘æ˜ç™½æˆ‘å‚ä¸è¿™é¡¹ç ”ç©¶æ˜¯è‡ªæ„¿çš„ï¼Œæˆ‘å¯ä»¥éšæ—¶é€€å‡ºè€Œæ— éœ€ç»™å‡ºä»»ä½•ç†ç”±ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•è´Ÿé¢åæœã€‚
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="consent2" name="consent2" class="consent-checkbox" required>
                        <label for="consent2" class="checkbox-text">
                            <strong>2. Study Understanding / ç ”ç©¶ç†è§£</strong><br>
                            I have read and understood the participant information sheet and have had the opportunity 
                            to ask questions about the study. I understand what participation involves.
                            <br><br>
                            æˆ‘å·²é˜…è¯»å¹¶ç†è§£å‚ä¸è€…ä¿¡æ¯è¡¨ï¼Œå¹¶æœ‰æœºä¼šè¯¢é—®æœ‰å…³ç ”ç©¶çš„é—®é¢˜ã€‚æˆ‘äº†è§£å‚ä¸æ¶‰åŠä»€ä¹ˆã€‚
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="consent3" name="consent3" class="consent-checkbox" required>
                        <label for="consent3" class="checkbox-text">
                            <strong>3. Data Collection and Use / æ•°æ®æ”¶é›†å’Œä½¿ç”¨</strong><br>
                            I consent to the collection and use of my data for the purposes of this research study. 
                            I understand that my data will be anonymized and used only for research purposes.
                            <br><br>
                            æˆ‘åŒæ„ä¸ºæœ¬ç ”ç©¶ç›®çš„æ”¶é›†å’Œä½¿ç”¨æˆ‘çš„æ•°æ®ã€‚æˆ‘äº†è§£æˆ‘çš„æ•°æ®å°†è¢«åŒ¿ååŒ–ï¼Œä»…ç”¨äºç ”ç©¶ç›®çš„ã€‚
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="consent4" name="consent4" class="consent-checkbox" required>
                        <label for="consent4" class="checkbox-text">
                            <strong>4. Data Storage and Retention / æ•°æ®å­˜å‚¨å’Œä¿ç•™</strong><br>
                            I understand that my anonymized data will be stored securely on Queen Mary University systems 
                            and will be retained until January 2026, after which it will be securely destroyed.
                            <br><br>
                            æˆ‘ç†è§£æˆ‘çš„åŒ¿åæ•°æ®å°†å®‰å…¨å­˜å‚¨åœ¨ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢ç³»ç»Ÿä¸­ï¼Œå¹¶ä¿ç•™è‡³2026å¹´1æœˆï¼Œä¹‹åå°†è¢«å®‰å…¨é”€æ¯ã€‚
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="consent5" name="consent5" class="consent-checkbox" required>
                        <label for="consent5" class="checkbox-text">
                            <strong>5. Data Access and Sharing / æ•°æ®è®¿é—®å’Œå…±äº«</strong><br>
                            I understand that only the research team will have access to my data, and that any research 
                            outputs will not contain information that could identify me personally.
                            <br><br>
                            æˆ‘ç†è§£åªæœ‰ç ”ç©¶å›¢é˜Ÿæ‰èƒ½è®¿é—®æˆ‘çš„æ•°æ®ï¼Œä»»ä½•ç ”ç©¶è¾“å‡ºéƒ½ä¸ä¼šåŒ…å«èƒ½å¤Ÿè¯†åˆ«æˆ‘ä¸ªäººèº«ä»½çš„ä¿¡æ¯ã€‚
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="consent6" name="consent6" class="consent-checkbox" required>
                        <label for="consent6" class="checkbox-text">
                            <strong>6. Right to Withdraw / é€€å‡ºæƒåˆ©</strong><br>
                            I understand that I can withdraw from the study at any time, including during the session, 
                            and can request that my data be deleted if it has not yet been anonymized.
                            <br><br>
                            æˆ‘ç†è§£æˆ‘å¯ä»¥éšæ—¶é€€å‡ºç ”ç©¶ï¼ŒåŒ…æ‹¬åœ¨ä¼šè¯æœŸé—´ï¼Œå¦‚æœæ•°æ®å°šæœªåŒ¿ååŒ–ï¼Œæˆ‘å¯ä»¥è¦æ±‚åˆ é™¤æˆ‘çš„æ•°æ®ã€‚
                        </label>
                    </div>

                    <div class="checkbox-item">
                        <input type="checkbox" id="consent7" name="consent7" class="consent-checkbox" required>
                        <label for="consent7" class="checkbox-text">
                            <strong>7. Informed Consent / çŸ¥æƒ…åŒæ„</strong><br>
                            I confirm that I am 18 years of age or older and that I give my informed consent to participate 
                            in this research study under the conditions outlined above.
                            <br><br>
                            æˆ‘ç¡®è®¤æˆ‘å·²å¹´æ»¡18å²ï¼Œå¹¶åœ¨ä¸Šè¿°æ¡ä»¶ä¸‹ç»™äºˆçŸ¥æƒ…åŒæ„å‚ä¸æœ¬ç ”ç©¶ã€‚
                        </label>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <strong>Important Reminders / é‡è¦æé†’:</strong>
                    <ul style="margin-top: 10px; margin-bottom: 0;">
                        <li>This is a low-risk research study / è¿™æ˜¯ä¸€é¡¹ä½é£é™©ç ”ç©¶</li>
                        <li>You can pause or stop the experience at any time / æ‚¨å¯ä»¥éšæ—¶æš‚åœæˆ–åœæ­¢ä½“éªŒ</li>
                        <li>If you experience any discomfort, please withdraw immediately / å¦‚æœæ‚¨æ„Ÿåˆ°ä»»ä½•ä¸é€‚ï¼Œè¯·ç«‹å³é€€å‡º</li>
                        <li>Contact the research team with any concerns: x.wan@qmul.ac.uk / å¦‚æœ‰ä»»ä½•ç–‘è™‘ï¼Œè¯·è”ç³»ç ”ç©¶å›¢é˜Ÿ</li>
                    </ul>
                </div>

                <div class="form-group" style="margin-top: 30px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                        <p style="margin-bottom: 15px; font-weight: 500;">
                            <span data-zh="By proceeding, I confirm that I have read, understood, and agree to all the above statements." data-en="By proceeding, I confirm that I have read, understood, and agree to all the above statements.">
                                By proceeding, I confirm that I have read, understood, and agree to all the above statements.
                            </span>
                            <br>
                            <span data-zh="é€šè¿‡ç»§ç»­ï¼Œæˆ‘ç¡®è®¤æˆ‘å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„ä¸Šè¿°æ‰€æœ‰å£°æ˜ã€‚" data-en="é€šè¿‡ç»§ç»­ï¼Œæˆ‘ç¡®è®¤æˆ‘å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„ä¸Šè¿°æ‰€æœ‰å£°æ˜ã€‚">
                                é€šè¿‡ç»§ç»­ï¼Œæˆ‘ç¡®è®¤æˆ‘å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„ä¸Šè¿°æ‰€æœ‰å£°æ˜ã€‚
                            </span>
                        </p>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 0;">
                            <span data-zh="Date and time of consent will be automatically recorded." data-en="Date and time of consent will be automatically recorded.">
                                Date and time of consent will be automatically recorded.
                            </span>
                            <br>
                            <span data-zh="åŒæ„çš„æ—¥æœŸå’Œæ—¶é—´å°†è‡ªåŠ¨è®°å½•ã€‚" data-en="åŒæ„çš„æ—¥æœŸå’Œæ—¶é—´å°†è‡ªåŠ¨è®°å½•ã€‚">
                                åŒæ„çš„æ—¥æœŸå’Œæ—¶é—´å°†è‡ªåŠ¨è®°å½•ã€‚
                            </span>
                        </p>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">
                        <span data-zh="Back / è¿”å›" data-en="Back / è¿”å›">Back / è¿”å›</span>
                    </button>
                    <button type="submit" class="btn btn-primary consent-submit" id="consent-submit" disabled>
                        <span data-zh="I Agree - Start Therapy Experience / æˆ‘åŒæ„ - å¼€å§‹æ²»ç–—ä½“éªŒ" data-en="I Agree - Start Therapy Experience / æˆ‘åŒæ„ - å¼€å§‹æ²»ç–—ä½“éªŒ">I Agree - Start Therapy Experience / æˆ‘åŒæ„ - å¼€å§‹æ²»ç–—ä½“éªŒ</span>
                    </button>
                </div>
            </form>

            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; text-align: center;">
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 0;">
                    <strong>Questions about your rights as a research participant?</strong><br>
                    Contact Queen Mary Ethics of Research Committee: research-ethics@qmul.ac.uk
                    <br><br>
                    <strong>å¯¹æ‚¨ä½œä¸ºç ”ç©¶å‚ä¸è€…çš„æƒåˆ©æœ‰ç–‘é—®ï¼Ÿ</strong><br>
                    è”ç³»ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢ç ”ç©¶ä¼¦ç†å§”å‘˜ä¼šï¼šresearch-ethics@qmul.ac.uk
                </p>
            </div>
        </div>

        <!-- Step 4: Therapy Experience -->
        <div class="content-section" id="section-4">
            <div class="therapy-container">
                <h1 class="therapy-title" data-zh="ğŸµ éŸ³ä¹ç–—æ„ˆç©ºé—´" data-en="ğŸµ Music Therapy Space">ğŸµ éŸ³ä¹ç–—æ„ˆç©ºé—´</h1>
                <div class="therapy-subtitle" data-zh="è®©éŸ³ä¹æ²»æ„ˆæ‚¨çš„å¿ƒçµ" data-en="Let music heal your soul">è®©éŸ³ä¹æ²»æ„ˆæ‚¨çš„å¿ƒçµ</div>
                
                <!-- è¾“å…¥é˜¶æ®µ -->
                <div class="input-section" id="therapy-input-section">
                    <label class="input-label" data-zh="è¯·æè¿°æ‚¨ç°åœ¨çš„æ„Ÿå—" data-en="Please describe how you feel right now">è¯·æè¿°æ‚¨ç°åœ¨çš„æ„Ÿå—</label>
                    <textarea 
                        id="emotion-input" 
                        class="emotion-textarea"
                        rows="4" 
                        data-zh-placeholder="ä¾‹å¦‚ï¼šæˆ‘æ„Ÿåˆ°ç„¦è™‘ï¼Œéœ€è¦æ”¾æ¾..."
                        data-en-placeholder="For example: I feel anxious and need to relax..."
                        placeholder="ä¾‹å¦‚ï¼šæˆ‘æ„Ÿåˆ°ç„¦è™‘ï¼Œéœ€è¦æ”¾æ¾..."
                    ></textarea>
                    <button id="therapy-submit-btn" class="therapy-btn" onclick="startTherapy()">
                        <span data-zh="å¼€å§‹ç–—æ„ˆä¹‹æ—…" data-en="Start Therapy Journey">å¼€å§‹ç–—æ„ˆä¹‹æ—…</span>
                    </button>
                </div>

                <!-- åé¦ˆé˜¶æ®µ -->
                <div class="feedback-text" id="feedback-text">
                    <span data-zh="æˆ‘ç†è§£æ‚¨ç°åœ¨çš„æ„Ÿå—ï¼Œæ­£åœ¨ä¸ºæ‚¨å¯»æ‰¾åˆé€‚çš„éŸ³ä¹..." 
                          data-en="I understand how you feel, finding the right music for you...">
                        æˆ‘ç†è§£æ‚¨ç°åœ¨çš„æ„Ÿå—ï¼Œæ­£åœ¨ä¸ºæ‚¨å¯»æ‰¾åˆé€‚çš„éŸ³ä¹...
                    </span>
                </div>

                <!-- å‘¼å¸å…‰ç¯é˜¶æ®µ -->
                <div class="breathing-circle" id="breathing-circle">
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                </div>
                <div class="breathing-hint" id="breathing-hint">
                    <span data-zh="è·Ÿéšå…‰ç¯çš„èŠ‚å¥æ·±å‘¼å¸ï¼Œè®©èº«å¿ƒæ”¾æ¾..." 
                          data-en="Follow the rhythm of the light rings and breathe deeply, let your mind and body relax...">
                        è·Ÿéšå…‰ç¯çš„èŠ‚å¥æ·±å‘¼å¸ï¼Œè®©èº«å¿ƒæ”¾æ¾...
                    </span>
                </div>

                <!-- Loading Spinner -->
                <div class="loading-spinner" id="loading-spinner"></div>

                <!-- è§†é¢‘æ’­æ”¾é˜¶æ®µ -->
                <div class="video-section" id="video-section">
                    <div class="video-container" style="position: relative;"> <video id="video-player" controls preload="auto"></video>
                        
                        <button id="manual-play-btn" class="therapy-btn" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; display: none;">
                            <span data-zh="â–¶ æ’­æ”¾ç–—æ„ˆéŸ³ä¹" data-en="â–¶ Play Healing Music">â–¶ æ’­æ”¾ç–—æ„ˆéŸ³ä¹</span>
                        </button>
                        </div>
                </div> 
            </div>
        </div>

        <!-- Step 5: Questionnaire -->
        <div class="content-section" id="section-5">
            <h1 data-zh="Post-Experience Questionnaire" data-en="Post-Experience Questionnaire">Post-Experience Questionnaire</h1>
            <h2 style="text-align: center; color: #666;" data-zh="ä½“éªŒåé—®å·" data-en="ä½“éªŒåé—®å·">ä½“éªŒåé—®å·</h2>
            
            <div class="alert alert-info">
                <span data-zh="Thank you for completing the EmoHeal therapy experience! Your feedback is valuable for our research." data-en="Thank you for completing the EmoHeal therapy experience! Your feedback is valuable for our research.">
                    Thank you for completing the EmoHeal therapy experience! Your feedback is valuable for our research.
                </span>
                <br>
                <span data-zh="æ„Ÿè°¢æ‚¨å®ŒæˆEmoHealæ²»ç–—ä½“éªŒï¼æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬çš„ç ”ç©¶å¾ˆæœ‰ä»·å€¼ã€‚" data-en="æ„Ÿè°¢æ‚¨å®ŒæˆEmoHealæ²»ç–—ä½“éªŒï¼æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬çš„ç ”ç©¶å¾ˆæœ‰ä»·å€¼ã€‚">
                    æ„Ÿè°¢æ‚¨å®ŒæˆEmoHealæ²»ç–—ä½“éªŒï¼æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬çš„ç ”ç©¶å¾ˆæœ‰ä»·å€¼ã€‚
                </span>
            </div>

            <form id="questionnaire-form">
                
                <!-- Part 1: Demographics -->
                <h2>Part 1: About You / ç¬¬ä¸€éƒ¨åˆ†ï¼šå…³äºæ‚¨</h2>
                
                <div class="form-group">
                    <label class="form-label">Age Group / å¹´é¾„ç»„:</label>
                    <select name="ageGroup" class="form-control" required>
                        <option value="">Select / é€‰æ‹©</option>
                        <option value="18-24">18-24</option>
                        <option value="25-34">25-34</option>
                        <option value="35-44">35-44</option>
                        <option value="45-54">45-54</option>
                        <option value="55-64">55-64</option>
                        <option value="65+">65+</option>
                    </select>
                </div>

                <!-- Part 2: Experience Evaluation -->
                <h2>Part 2: Experience Evaluation / ç¬¬äºŒéƒ¨åˆ†ï¼šä½“éªŒè¯„ä¼°</h2>
                <p style="color: #666; margin-bottom: 30px;">
                    Please rate your agreement with the following statements on a scale from 1 (Strongly Disagree) to 5 (Strongly Agree).
                    <br>
                    è¯·æ ¹æ®1ï¼ˆå¼ºçƒˆä¸åŒæ„ï¼‰åˆ°5ï¼ˆå¼ºçƒˆåŒæ„ï¼‰çš„è¯„åˆ†æ ‡å‡†ï¼Œå¯¹ä»¥ä¸‹é™ˆè¿°è¿›è¡Œè¯„åˆ†ã€‚
                </p>

                <!-- Question 1 -->
                <div class="form-group">
                    <label class="form-label">
                        <strong>Q1.</strong> The generated video accurately reflected the emotions I described in my text / 
                        æ‰€ç”Ÿæˆçš„è§†é¢‘å‡†ç¡®åœ°åæ˜ äº†æˆ‘åœ¨æ–‡æœ¬ä¸­æè¿°çš„æƒ…æ„Ÿ
                    </label>
                    <div class="likert-scale">
                        <div class="scale-label">Strongly Disagree<br>å¼ºçƒˆä¸åŒæ„</div>
                        <div class="scale-options">
                            <div class="scale-option">
                                <input type="radio" name="q1_accuracy" value="1" id="q1_1" required>
                                <label for="q1_1" class="scale-number">1</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q1_accuracy" value="2" id="q1_2">
                                <label for="q1_2" class="scale-number">2</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q1_accuracy" value="3" id="q1_3">
                                <label for="q1_3" class="scale-number">3</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q1_accuracy" value="4" id="q1_4">
                                <label for="q1_4" class="scale-number">4</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q1_accuracy" value="5" id="q1_5">
                                <label for="q1_5" class="scale-number">5</label>
                            </div>
                        </div>
                        <div class="scale-label">Strongly Agree<br>å¼ºçƒˆåŒæ„</div>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="form-group">
                    <label class="form-label">
                        <strong>Q2.</strong> Watching the video had a positive impact on my mood (e.g., made me feel calmer, more comfortable, or more ready for sleep) / 
                        è§‚çœ‹è¿™ä¸ªè§†é¢‘å¯¹æˆ‘çš„æƒ…ç»ªæœ‰ç§¯æçš„å½±å“ï¼ˆä¾‹å¦‚ï¼Œè®©æˆ‘æ„Ÿè§‰æ›´å¹³é™ã€æ›´èˆ’é€‚ï¼Œæˆ–æ›´å‡†å¤‡å¥½å…¥ç¡ï¼‰
                    </label>
                    <div class="likert-scale">
                        <div class="scale-label">Strongly Disagree<br>å¼ºçƒˆä¸åŒæ„</div>
                        <div class="scale-options">
                            <div class="scale-option">
                                <input type="radio" name="q2_appropriateness" value="1" id="q2_1" required>
                                <label for="q2_1" class="scale-number">1</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q2_appropriateness" value="2" id="q2_2">
                                <label for="q2_2" class="scale-number">2</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q2_appropriateness" value="3" id="q2_3">
                                <label for="q2_3" class="scale-number">3</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q2_appropriateness" value="4" id="q2_4">
                                <label for="q2_4" class="scale-number">4</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q2_appropriateness" value="5" id="q2_5">
                                <label for="q2_5" class="scale-number">5</label>
                            </div>
                        </div>
                        <div class="scale-label">Strongly Agree<br>å¼ºçƒˆåŒæ„</div>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="form-group">
                    <label class="form-label">
                        <strong>Q3.</strong> I found the overall atmosphere of the therapeutic video to be positive and appropriate / 
                        æˆ‘æ„Ÿè§‰æ•´ä¸ªç–—æ„ˆè§†é¢‘çš„æ°›å›´æ˜¯ç§¯æä¸”æ°å½“çš„
                    </label>
                    <div class="likert-scale">
                        <div class="scale-label">Strongly Disagree<br>å¼ºçƒˆä¸åŒæ„</div>
                        <div class="scale-options">
                            <div class="scale-option">
                                <input type="radio" name="q3_relaxation" value="1" id="q3_1" required>
                                <label for="q3_1" class="scale-number">1</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q3_relaxation" value="2" id="q3_2">
                                <label for="q3_2" class="scale-number">2</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q3_relaxation" value="3" id="q3_3">
                                <label for="q3_3" class="scale-number">3</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q3_relaxation" value="4" id="q3_4">
                                <label for="q3_4" class="scale-number">4</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q3_relaxation" value="5" id="q3_5">
                                <label for="q3_5" class="scale-number">5</label>
                            </div>
                        </div>
                        <div class="scale-label">Strongly Agree<br>å¼ºçƒˆåŒæ„</div>
                    </div>
                </div>

                <!-- Question 4 -->
                <div class="form-group">
                    <label class="form-label">
                        <strong>Q4.</strong> The quality and suitability of the music in the video were high / 
                        è§†é¢‘ä¸­éŸ³ä¹çš„è´¨é‡å’Œé€‚å®œæ€§å¾ˆé«˜
                    </label>
                    <div class="likert-scale">
                        <div class="scale-label">Strongly Disagree<br>å¼ºçƒˆä¸åŒæ„</div>
                        <div class="scale-options">
                            <div class="scale-option">
                                <input type="radio" name="q4_reuse" value="1" id="q4_1" required>
                                <label for="q4_1" class="scale-number">1</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q4_reuse" value="2" id="q4_2">
                                <label for="q4_2" class="scale-number">2</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q4_reuse" value="3" id="q4_3">
                                <label for="q4_3" class="scale-number">3</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q4_reuse" value="4" id="q4_4">
                                <label for="q4_4" class="scale-number">4</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q4_reuse" value="5" id="q4_5">
                                <label for="q4_5" class="scale-number">5</label>
                            </div>
                        </div>
                        <div class="scale-label">Strongly Agree<br>å¼ºçƒˆåŒæ„</div>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="form-group">
                    <label class="form-label">
                        <strong>Q5.</strong> The audio and visuals in the video worked well together in a coherent way / 
                        è§†é¢‘ä¸­çš„éŸ³é¢‘å’Œè§†è§‰å…ƒç´ å¾ˆå¥½åœ°ã€è¿è´¯åœ°ç»“åˆåœ¨äº†ä¸€èµ·
                    </label>
                    <div class="likert-scale">
                        <div class="scale-label">Strongly Disagree<br>å¼ºçƒˆä¸åŒæ„</div>
                        <div class="scale-options">
                            <div class="scale-option">
                                <input type="radio" name="q5_usability" value="1" id="q5_1" required>
                                <label for="q5_1" class="scale-number">1</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q5_usability" value="2" id="q5_2">
                                <label for="q5_2" class="scale-number">2</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q5_usability" value="3" id="q5_3">
                                <label for="q5_3" class="scale-number">3</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q5_usability" value="4" id="q5_4">
                                <label for="q5_4" class="scale-number">4</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" name="q5_usability" value="5" id="q5_5">
                                <label for="q5_5" class="scale-number">5</label>
                            </div>
                        </div>
                        <div class="scale-label">Strongly Agree<br>å¼ºçƒˆåŒæ„</div>
                    </div>
                </div>

                <!-- Part 3: Open-ended feedback -->
                <h2>Part 3: Your Thoughts / ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ‚¨çš„æƒ³æ³•</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Please share your thoughts in your own words. Your responses can be in English or Chinese.
                    <br>
                    è¯·ç”¨æ‚¨è‡ªå·±çš„è¯åˆ†äº«æ‚¨çš„æƒ³æ³•ã€‚æ‚¨å¯ä»¥ç”¨è‹±æ–‡æˆ–ä¸­æ–‡å›ç­”ã€‚
                </p>

                <div class="form-group">
                    <label class="form-label">
                        <strong>Q6.</strong> What did you like most about the EmoHeal experience? / 
                        æ‚¨æœ€å–œæ¬¢EmoHealä½“éªŒçš„ä»€ä¹ˆæ–¹é¢ï¼Ÿ
                    </label>
                    <textarea name="q6_liked_most" class="form-control" rows="4" 
                              placeholder="Please share what you found most enjoyable or helpful... / è¯·åˆ†äº«æ‚¨è§‰å¾—æœ€æ„‰å¿«æˆ–æœ€æœ‰å¸®åŠ©çš„æ–¹é¢..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <strong>Q7.</strong> What could be improved about the system? / 
                        ç³»ç»Ÿæœ‰å“ªäº›æ–¹é¢å¯ä»¥æ”¹è¿›ï¼Ÿ
                    </label>
                    <textarea name="q7_improvements" class="form-control" rows="4" 
                              placeholder="Please suggest any improvements or changes... / è¯·æå‡ºä»»ä½•æ”¹è¿›å»ºè®®æˆ–æ›´æ”¹..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <strong>Q8.</strong> Any additional comments or feedback? / 
                        è¿˜æœ‰å…¶ä»–æ„è§æˆ–åé¦ˆå—ï¼Ÿ
                    </label>
                    <textarea name="q8_additional_comments" class="form-control" rows="4" 
                              placeholder="Feel free to share any other thoughts... / è¯·éšæ„åˆ†äº«å…¶ä»–æƒ³æ³•..."></textarea>
                </div>

                <div class="alert alert-success">
                    <strong>Thank you! / è°¢è°¢æ‚¨ï¼</strong><br>
                    Your participation and feedback contribute valuable insights to our research on AI-assisted therapeutic systems.
                    <br>
                    æ‚¨çš„å‚ä¸å’Œåé¦ˆä¸ºæˆ‘ä»¬å…³äºAIè¾…åŠ©æ²»ç–—ç³»ç»Ÿçš„ç ”ç©¶æä¾›äº†å®è´µçš„è§è§£ã€‚
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="alert('æ²»ç–—ä½“éªŒæ— æ³•é‡å¤ã€‚å¦‚éœ€é‡æ–°å¼€å§‹æ•´ä¸ªç ”ç©¶ï¼Œè¯·è”ç³»ç ”ç©¶å›¢é˜Ÿã€‚\nThe therapy experience cannot be repeated. To restart the entire study, please contact the research team.')">
                        Back / è¿”å›
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Submit Questionnaire / æäº¤é—®å·
                    </button>
                </div>
            </form>

            <div style="text-align: center; padding: 1.5rem;">
                <p style="font-size: 0.85rem; color: #666; margin-bottom: 0;">
                    Your responses will be processed anonymously and stored securely according to university data protection policies.
                    <br>
                    æ‚¨çš„å›ç­”å°†è¢«åŒ¿åå¤„ç†ï¼Œå¹¶æ ¹æ®å¤§å­¦æ•°æ®ä¿æŠ¤æ”¿ç­–å®‰å…¨å­˜å‚¨ã€‚
                </p>
            </div>
        </div>

        <!-- Step 6: Thank You -->
        <div class="content-section" id="section-6">
            <h1 style="text-align: center; color: #28a745;">ğŸ‰ Study Complete!</h1>
            <h2 style="text-align: center; color: #666;">ç ”ç©¶å®Œæˆï¼</h2>
            
            <div class="alert alert-success">
                <strong>Thank you for participating in the EmoHeal research study!</strong><br>
                Your contribution helps advance our understanding of AI-assisted therapeutic systems.
                <br><br>
                <strong>æ„Ÿè°¢æ‚¨å‚ä¸EmoHealç ”ç©¶ï¼</strong><br>
                æ‚¨çš„è´¡çŒ®æœ‰åŠ©äºæˆ‘ä»¬æ·±å…¥ç†è§£AIè¾…åŠ©æ²»ç–—ç³»ç»Ÿã€‚
            </div>

            <div style="text-align: center; margin: 40px 0;">
                <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <h2 style="margin-bottom: 15px; color: white;">Study Successfully Completed</h2>
                    <h3 style="color: white; opacity: 0.9;">ç ”ç©¶æˆåŠŸå®Œæˆ</h3>
                    <p style="font-size: 1.1rem; margin-top: 20px; opacity: 0.9;">
                        Session ID: <strong id="session-id">Loading...</strong>
                    </p>
                </div>
            </div>

            <h2>What Happens Next? / æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h2>
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 25px 0;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start;">
                    <div>
                        <h3 style="color: #990033; margin-bottom: 15px;">ğŸ”¬ Research Process</h3>
                        <ul style="line-height: 1.8;">
                            <li>Your data has been securely stored</li>
                            <li>All responses are completely anonymous</li>
                            <li>Data will contribute to academic research</li>
                            <li>Results may be published in academic journals</li>
                        </ul>
                    </div>
                    <div>
                        <h3 style="color: #990033; margin-bottom: 15px;">ğŸ”¬ ç ”ç©¶æµç¨‹</h3>
                        <ul style="line-height: 1.8;">
                            <li>æ‚¨çš„æ•°æ®å·²å®‰å…¨å­˜å‚¨</li>
                            <li>æ‰€æœ‰å›ç­”å®Œå…¨åŒ¿å</li>
                            <li>æ•°æ®å°†ç”¨äºå­¦æœ¯ç ”ç©¶</li>
                            <li>ç»“æœå¯èƒ½å‘è¡¨åœ¨å­¦æœ¯æœŸåˆŠä¸Š</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h2>Data and Privacy / æ•°æ®å’Œéšç§</h2>
            <div style="background: #e7f3ff; padding: 20px; border-radius: 10px; border-left: 5px solid #007bff;">
                <h3 style="color: #007bff; margin-bottom: 15px;">ğŸ“Š Your Data</h3>
                <p>
                    <strong>Storage:</strong> Securely stored on Queen Mary University systems<br>
                    <strong>Retention:</strong> Until January 2026, then securely destroyed<br>
                    <strong>Access:</strong> Only accessible to the research team<br>
                    <strong>Usage:</strong> Academic research purposes only
                </p>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #ccc;">
                <p>
                    <strong>å­˜å‚¨ï¼š</strong> å®‰å…¨å­˜å‚¨åœ¨ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢ç³»ç»Ÿä¸­<br>
                    <strong>ä¿ç•™ï¼š</strong> è‡³2026å¹´1æœˆï¼Œç„¶åå®‰å…¨é”€æ¯<br>
                    <strong>è®¿é—®ï¼š</strong> ä»…ç ”ç©¶å›¢é˜Ÿå¯è®¿é—®<br>
                    <strong>ä½¿ç”¨ï¼š</strong> ä»…ç”¨äºå­¦æœ¯ç ”ç©¶ç›®çš„
                </p>
            </div>

            <h2>Download Your Data / ä¸‹è½½æ‚¨çš„æ•°æ®</h2>
            <p style="margin-bottom: 20px;">
                As a participant, you have the right to download a copy of your anonymized data.
                This file contains your session information and responses in JSON format.
                <br><br>
                ä½œä¸ºå‚ä¸è€…ï¼Œæ‚¨æœ‰æƒä¸‹è½½åŒ¿åæ•°æ®çš„å‰¯æœ¬ã€‚æ­¤æ–‡ä»¶åŒ…å«JSONæ ¼å¼çš„ä¼šè¯ä¿¡æ¯å’Œå›ç­”ã€‚
            </p>
            
            <div style="text-align: center; margin: 30px 0;">
                <button onclick="exportData()" class="btn btn-primary" style="font-size: 1.1rem; padding: 15px 30px;">
                    ğŸ“ Download My Anonymous Data / ä¸‹è½½æˆ‘çš„åŒ¿åæ•°æ®
                </button>
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    File format: JSON | No personal identifiers included<br>
                    æ–‡ä»¶æ ¼å¼ï¼šJSON | ä¸åŒ…å«ä¸ªäººè¯†åˆ«ä¿¡æ¯
                </p>
            </div>

            <h2>Research Team Contact / ç ”ç©¶å›¢é˜Ÿè”ç³»æ–¹å¼</h2>
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h3>ğŸ“§ Questions about this study?</h3>
                        <p>
                            <strong>Primary Contact:</strong><br>
                            Xinchen Wan<br>
                            Postgraduate student<br>
                            Email: x.wan@se24.qmul.ac.uk
                        </p>
                        <p>
                            <strong>Supervisor:</strong><br>
                            Dr. Huan Zhang
                        </p>
                    </div>
                    <div>
                        <h3>ğŸ“§ å¯¹æœ¬ç ”ç©¶æœ‰ç–‘é—®ï¼Ÿ</h3>
                        <p>
                            <strong>ä¸»è¦è”ç³»äººï¼š</strong><br>
                            ä¸‡æ¬£è¾°<br>
                            ç¡•å£«ç”Ÿ<br>
                            é‚®ç®±ï¼šx.wan@se24.qmul.ac.uk
                        </p>
                        <p>
                            <strong>å¯¼å¸ˆï¼š</strong><br>
                            å¼ æ¬¢åšå£«
                        </p>
                    </div>
                </div>
            </div>

            <div class="alert alert-info" style="margin: 30px 0;">
                <strong>ğŸ” Interested in our research?</strong><br>
                Follow our work on AI and digital health at Queen Mary University of London.
                Published results from this study will be made available through academic channels.
                <br><br>
                <strong>ğŸ” å¯¹æˆ‘ä»¬çš„ç ”ç©¶æ„Ÿå…´è¶£ï¼Ÿ</strong><br>
                å…³æ³¨æˆ‘ä»¬åœ¨ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢è¿›è¡Œçš„AIå’Œæ•°å­—å¥åº·ç ”ç©¶ã€‚
                æœ¬ç ”ç©¶çš„å‘è¡¨ç»“æœå°†é€šè¿‡å­¦æœ¯æ¸ é“æä¾›ã€‚
            </div>

            <div class="btn-group" style="margin-top: 40px;">
                <button onclick="restartStudy()" class="btn btn-secondary">
                    ğŸ”„ Start New Session / å¼€å§‹æ–°ä¼šè¯
                </button>
                <button onclick="window.close()" class="btn btn-primary">
                    âœ… Close Window / å…³é—­çª—å£
                </button>
            </div>

            <div style="text-align: center; margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #990033, #b30039); color: white; border-radius: 15px;">
                <h2 style="color: white; margin-bottom: 20px;">Thank You Once Again!</h2>
                <h3 style="color: white; opacity: 0.9; margin-bottom: 20px;">å†æ¬¡æ„Ÿè°¢æ‚¨ï¼</h3>
                <p style="font-size: 1.1rem; line-height: 1.6; opacity: 0.9;">
                    Your participation in this research contributes to the advancement of AI-assisted therapeutic technologies 
                    and helps us better understand how technology can support mental health and wellbeing.
                    <br><br>
                    æ‚¨å‚ä¸è¿™é¡¹ç ”ç©¶æœ‰åŠ©äºæ¨è¿›AIè¾…åŠ©æ²»ç–—æŠ€æœ¯çš„å‘å±•ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°äº†è§£æŠ€æœ¯å¦‚ä½•æ”¯æŒå¿ƒç†å¥åº·å’Œç¦ç¥‰ã€‚
                </p>
            </div>

            <div style="text-align: center; padding: 1.5rem;">
                <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">
                    <strong>Ethics Reference:</strong> QMERC20.565.DSEECS25.045
                </p>
                <p style="font-size: 0.85rem; color: #666; margin-bottom: 0;">
                    This study has been reviewed and approved by the Queen Mary Ethics of Research Committee.
                    <br>
                    æœ¬ç ”ç©¶å·²é€šè¿‡ä¼¦æ•¦å¤§å­¦ç›ä¸½å¥³ç‹å­¦é™¢ç ”ç©¶ä¼¦ç†å§”å‘˜ä¼šå®¡æ‰¹ã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let currentLanguage = 'zh';
        let studyData = {
            sessionId: 'EMOHEAL_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
            startTime: new Date().toISOString(),
            participantInfo: {},
            consentData: {},
            therapyData: {},
            questionnaireData: {},
            completed: false
        };

        // API configuration - ä½¿ç”¨å…¨å±€é…ç½®
        const API_CONFIG = {
            dataCollectionUrl: window.EXPERIMENT_CONFIG?.apiBaseUrl || 'http://127.0.0.1:5002',
            emotionApiUrl: window.EXPERIMENT_CONFIG?.emotionApiUrl || 'http://127.0.0.1:5001'
        };
        
        // è°ƒè¯•ä¿¡æ¯
        console.log('ğŸ”§ API Configuration Loaded:');
        console.log('ğŸ“¡ Data Collection:', API_CONFIG.dataCollectionUrl);
        console.log('ğŸ§  Emotion Analysis:', API_CONFIG.emotionApiUrl);

        // Multi-language support
        const translations = {
            zh: {
                connectionError: 'è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
                noMusicFound: 'æœªæ‰¾åˆ°åŒ¹é…çš„éŸ³ä¹',
                noVideoPath: 'æœªæ‰¾åˆ°åˆé€‚çš„ç–—æ„ˆéŸ³ä¹',
                inputRequired: 'è¯·æè¿°æ‚¨çš„æ„Ÿå—',
                therapyComplete: 'ğŸµ ç–—æ„ˆä½“éªŒå®Œæˆï¼\n\nå³å°†è¿›å…¥åé¦ˆé—®å·ç¯èŠ‚...',
                submitSuccess: 'é—®å·æäº¤æˆåŠŸï¼',
                submitError: 'æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•',
                validationError: 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ'
            },
            en: {
                connectionError: 'Connection failed, please try again later',
                noMusicFound: 'No matching music found',
                noVideoPath: 'No suitable therapeutic music found',
                inputRequired: 'Please describe your feelings',
                therapyComplete: 'ğŸµ Therapy Experience Completed!\n\nProceeding to feedback questionnaire...',
                submitSuccess: 'Questionnaire submitted successfully!',
                submitError: 'Submission failed, please try again',
                validationError: 'Please fill in all required fields'
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ EmoHealå®Œæ•´æµç¨‹ç³»ç»Ÿå·²åŠ è½½');
            updateProgressSteps();
            updateLanguageContent();
            
            // Load session ID in thank you page
            document.getElementById('session-id').textContent = studyData.sessionId;
            
            // Initialize form event listeners
            initializeFormListeners();
        });

        // Language switching
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateLanguageContent();
        }

        function updateLanguageContent() {
            const elements = document.querySelectorAll('[data-zh][data-en]');
            elements.forEach(element => {
                const text = currentLanguage === 'zh' ? element.dataset.zh : element.dataset.en;
                element.textContent = text;
            });
            
            // Update placeholders
            const placeholderElements = document.querySelectorAll('[data-zh-placeholder][data-en-placeholder]');
            placeholderElements.forEach(element => {
                const placeholder = currentLanguage === 'zh' ? element.dataset.zhPlaceholder : element.dataset.enPlaceholder;
                element.placeholder = placeholder;
            });
        }

        // Step navigation
        function updateProgressSteps() {
            for (let i = 1; i <= 6; i++) {
                const step = document.getElementById(`step-${i}`);
                step.classList.remove('completed', 'current', 'pending');
                
                if (i < currentStep) {
                    step.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('current');
                } else {
                    step.classList.add('pending');
                }
            }
            
            // Show current section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`section-${currentStep}`).classList.add('active');
        }

        function nextStep() {
            if (currentStep < 6) {
                currentStep++;
                updateProgressSteps();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateProgressSteps();
            }
        }

        // Form handling
        function initializeFormListeners() {
            // Participant form
            document.getElementById('participant-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                studyData.participantInfo = Object.fromEntries(formData);
                studyData.participantInfo.timestamp = new Date().toISOString();
                console.log('å‚ä¸è€…ä¿¡æ¯å·²ä¿å­˜:', studyData.participantInfo);
                nextStep();
            });

            // Consent form
            document.getElementById('consent-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                studyData.consentData = Object.fromEntries(formData);
                studyData.consentData.timestamp = new Date().toISOString();
                console.log('åŒæ„æ•°æ®å·²ä¿å­˜:', studyData.consentData);
                nextStep();
            });

            // Consent checkboxes
            const consentCheckboxes = document.querySelectorAll('#consent-form input[type="checkbox"]');
            const consentSubmit = document.getElementById('consent-submit');
            
            consentCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const allChecked = Array.from(consentCheckboxes).every(cb => cb.checked);
                    consentSubmit.disabled = !allChecked;
                });
            });

            // Questionnaire form
            document.getElementById('questionnaire-form').addEventListener('submit', function(e) {
                e.preventDefault();
                submitQuestionnaire();
            });
        }

        // Therapy experience functions
        function startTherapy() {
            const emotion = document.getElementById('emotion-input').value.trim();
            if (!emotion) {
                alert(translations[currentLanguage].inputRequired);
                return;
            }

            studyData.therapyData.userInput = emotion;
            studyData.therapyData.startTime = new Date().toISOString();

            // Disable button
            document.getElementById('therapy-submit-btn').disabled = true;
            
            // Show feedback phase
            showFeedbackPhase();

            // Delay and show breathing phase
            setTimeout(() => {
                showBreathingPhase();
                
                // Start music fetching
                fetchMusic(emotion);
            }, 2000);
        }

        function showFeedbackPhase() {
            document.getElementById('therapy-input-section').style.display = 'none';
            document.getElementById('feedback-text').style.display = 'block';
        }

        function showBreathingPhase() {
            document.getElementById('feedback-text').style.display = 'none';
            document.getElementById('breathing-circle').style.display = 'block';
            document.getElementById('breathing-hint').style.display = 'block';
            document.getElementById('loading-spinner').style.display = 'block';
        }
        

        // vvvvvv ä»è¿™é‡Œå¼€å§‹å¤åˆ¶ï¼Œç”¨æ¥æ›¿æ¢æ‰æ‚¨åŸæ¥çš„æ•´ä¸ª showVideoPhase å‡½æ•° vvvvvv
        function showVideoPhase(videoUrl) {
            document.getElementById('breathing-circle').style.display = 'none';
            document.getElementById('breathing-hint').style.display = 'none';
            document.getElementById('loading-spinner').style.display = 'none';
            
            const video = document.getElementById('video-player');
            const playBtn = document.getElementById('manual-play-btn');
            const videoSection = document.getElementById('video-section');
            
            video.src = videoUrl;
            video.preload = 'auto'; // è®©æµè§ˆå™¨å¼€å§‹åŠ è½½è§†é¢‘
            
            // å½“è§†é¢‘æ•°æ®è¶³ä»¥å¼€å§‹æ’­æ”¾æ—¶
            video.oncanplay = () => {
                console.log('è§†é¢‘å·²å‡†å¤‡å¥½ï¼Œå¯ä»¥æ’­æ”¾');
                
                // æ˜¾ç¤ºè§†é¢‘åŒºåŸŸå’Œæˆ‘ä»¬æ–°å¢çš„æ’­æ”¾æŒ‰é’®
                videoSection.style.display = 'block';
                playBtn.style.display = 'block';
                updateLanguageContent(); // ç¡®ä¿æŒ‰é’®ä¸Šçš„æ–‡å­—æ˜¯æ­£ç¡®çš„è¯­è¨€
                
                setTimeout(() => {
                    videoSection.style.opacity = '1';
                }, 100);
            };

            // ã€æ ¸å¿ƒä¿®æ­£ã€‘ä¸ºæ–°çš„æ’­æ”¾æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            playBtn.onclick = () => {
                video.play();
                playBtn.style.display = 'none'; // ç”¨æˆ·ç‚¹å‡»åï¼Œéšè—æ’­æ”¾æŒ‰é’®
            };
            
            // ç›‘å¬è§†é¢‘æ’­æ”¾ç»“æŸäº‹ä»¶ (è¿™éƒ¨åˆ†é€»è¾‘ä¸å˜)
            video.onended = () => {
                console.log('è§†é¢‘æ’­æ”¾å®Œæˆ');
                studyData.therapyData.completed = true;
                studyData.therapyData.endTime = new Date().toISOString();
                
                setTimeout(() => {
                    alert(translations[currentLanguage].therapyComplete);
                    nextStep(); // å‰å¾€é—®å·é¡µé¢
                }, 2000);
            };

            // å¦‚æœè§†é¢‘åŠ è½½å‡ºé”™ï¼Œæä¾›åé¦ˆ
            video.onerror = () => {
                console.error("è§†é¢‘åŠ è½½é”™è¯¯");
                handleTherapyError("è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•ã€‚");
            };
        }
// ^^^^^^ åˆ°è¿™é‡Œå¤åˆ¶ç»“æŸ ^^^^^^// vvvvvv ä»è¿™é‡Œå¼€å§‹å¤åˆ¶ï¼Œç”¨æ¥æ›¿æ¢åŸæ¥çš„ showVideoPhase å‡½æ•° vvvvvv



        
        async function fetchMusic(emotion) {
            // ã€æ ¸å¿ƒä¿®æ­£ã€‘: è°ƒç”¨æ­£ç¡®çš„ã€å¸¦è¿›åº¦åé¦ˆçš„æµå¼APIç«¯ç‚¹
            const API_ENDPOINT = `${API_CONFIG.emotionApiUrl}/api/music/search-with-progress`;

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream' // æ˜ç¡®å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬éœ€è¦äº‹ä»¶æµ
                    },
                    body: JSON.stringify({
                        query: emotion,
                        settings: {
                            duration: '3min',
                            max_results: 1
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`ç½‘ç»œå“åº”é”™è¯¯: ${response.status}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder('utf-8');
                
                // å¾ªç¯è¯»å–æœåŠ¡å™¨å‘é€çš„äº‹ä»¶æµæ•°æ®
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) {
                        console.log('æ•°æ®æµç»“æŸ');
                        break;
                    }
                    
                    const chunk = decoder.decode(value);
                    // æœåŠ¡å™¨å¯èƒ½ä¸€æ¬¡å‘é€å¤šä¸ªäº‹ä»¶ï¼Œç”¨'\n\n'åˆ†å‰²
                    const lines = chunk.split('\n\n').filter(line => line.trim() !== '');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const jsonData = line.substring(6);
                            try {
                                const data = JSON.parse(jsonData);
                                
                                // æ›´æ–°UIä¸Šçš„è¿›åº¦ä¿¡æ¯
                                document.getElementById('feedback-text').innerText = data.message || 'æ­£åœ¨å¤„ç†...';

                                if (data.step === 'completed' && data.status === 'success') {
                                    // ã€æ ¸å¿ƒä¿®æ­£ã€‘: å½“æµç¨‹å®Œæˆæ—¶ï¼Œç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„å®Œæ•´è§†é¢‘URL
                                    if (data.data?.segments?.length > 0) {
                                        const videoSegment = data.data.segments[0];
                                        const finalVideoUrl = videoSegment.url; // åç«¯å·²ç»æ‹¼æ¥å¥½äº†å®Œæ•´çš„R2 URL

                                        console.log('æˆåŠŸè·å–åˆ°æœ€ç»ˆçš„è§†é¢‘URL:', finalVideoUrl);
                                        studyData.therapyData.selectedMusic = videoSegment;
                                        
                                        // ä¼ é€’æ­£ç¡®çš„URLç»™è§†é¢‘æ’­æ”¾é˜¶æ®µ
                                        showVideoPhase(finalVideoUrl);
                                    } else {
                                        handleTherapyError(translations[currentLanguage].noMusicFound);
                                    }
                                } else if (data.step === 'error') {
                                    handleTherapyError(data.message || 'åç«¯å¤„ç†å¤±è´¥');
                                }
                            } catch (e) {
                                console.error('è§£æJSONå¤±è´¥:', jsonData, e);
                            }
                        }
                    }
                }

            } catch (error) {
                console.error('Fetch Music é”™è¯¯:', error);
                handleTherapyError(translations[currentLanguage].connectionError);
            }
        }

// ^^^^^^ åˆ°è¿™é‡Œå¤åˆ¶ç»“æŸ ^^^^^^


        

        function handleTherapyError(message) {
            alert(message);
            resetTherapyInterface();
        }

        function resetTherapyInterface() {
            // Reset therapy interface
            document.getElementById('therapy-input-section').style.display = 'block';
            document.getElementById('feedback-text').style.display = 'none';
            document.getElementById('breathing-circle').style.display = 'none';
            document.getElementById('breathing-hint').style.display = 'none';
            document.getElementById('loading-spinner').style.display = 'none';
            document.getElementById('video-section').style.display = 'none';
            document.getElementById('video-section').style.opacity = '0';
            
            document.getElementById('emotion-input').value = '';
            document.getElementById('therapy-submit-btn').disabled = false;
            
            // Stop video
            const video = document.getElementById('video-player');
            video.pause();
            video.src = '';
        }

        // Questionnaire submission
        async function submitQuestionnaire() {
            const form = document.getElementById('questionnaire-form');
            const formData = new FormData(form);
            
            // Validate required fields
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value && field.type !== 'radio') {
                    isValid = false;
                } else if (field.type === 'radio') {
                    const radioGroup = form.querySelectorAll(`[name="${field.name}"]`);
                    const hasChecked = Array.from(radioGroup).some(radio => radio.checked);
                    if (!hasChecked) {
                        isValid = false;
                    }
                }
            });
            
            if (!isValid) {
                alert(translations[currentLanguage].validationError);
                return;
            }

            studyData.questionnaireData = Object.fromEntries(formData);
            studyData.questionnaireData.timestamp = new Date().toISOString();
            studyData.completed = true;

            try {
                const response = await fetch(`${API_CONFIG.dataCollectionUrl}/submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(studyData)
                });

                if (response.ok) {
                    console.log('é—®å·æäº¤æˆåŠŸ');
                    alert(translations[currentLanguage].submitSuccess);
                    nextStep();
                } else {
                    throw new Error('Submit failed');
                }
            } catch (error) {
                console.error('æäº¤é”™è¯¯:', error);
                alert(translations[currentLanguage].submitError);
            }
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(studyData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `emoheal_data_${studyData.sessionId}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Restart study
        function restartStudy() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰æ•°æ®ã€‚\nAre you sure you want to restart? This will clear all data.')) {
                currentStep = 1;
                studyData = {
                    sessionId: 'EMOHEAL_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    startTime: new Date().toISOString(),
                    participantInfo: {},
                    consentData: {},
                    therapyData: {},
                    questionnaireData: {},
                    completed: false
                };
                
                // Reset all forms
                document.querySelectorAll('form').forEach(form => form.reset());
                document.getElementById('consent-submit').disabled = true;
                
                resetTherapyInterface();
                updateProgressSteps();
                
                // Update session ID display
                document.getElementById('session-id').textContent = studyData.sessionId;
            }
        }
    </script>
</body>
</html>